<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§∂‡§æ‡§®‡§¶‡§æ‡§∞ ‡§Ö‡§Ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡•Ä</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
    .section {
      background: rgba(255, 255, 255, 0.95);
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      position: relative;
    }
    .player-input {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    input, select, button {
      padding: 12px 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    button {
      background: var(--secondary);
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    button:hover {
      background: var(--primary);
      transform: scale(1.02);
    }
    .game-screen {
      display: none;
      position: relative;
    }
    .question-box {
      font-size: 28px;
      margin: 2rem 0;
      padding: 2rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      border-radius: 12px;
      text-align: center;
      animation: pulse 2s infinite;
    }
    .question-info {
      text-align: center;
      margin-bottom: 1rem;
      font-weight: bold;
      font-size: 18px;
    }
    .answers {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin: 2rem 0;
    }
    .answer-btn {
      padding: 1.5rem;
      font-size: 18px;
      background: white;
      color: var(--primary);
      border: 2px solid var(--secondary);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .answer-btn:hover {
      background: var(--secondary);
      color: white;
      transform: translateY(-3px);
    }
    .answer-type-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .answer-type-btn {
      padding: 1rem 1.5rem;
      font-size: 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .answer-type-btn:hover {
      background-color: var(--secondary);
    }
    .leaderboard-item {
      display: grid;
      grid-template-columns: 30px 1.5fr 0.7fr 0.7fr 0.7fr 0.7fr 0.7fr 0.7fr;
      align-items: center;
      padding: 1rem;
      margin: 0.5rem 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-size: 14px;
    }
    /* ‡§ü‡•Ä‡§Æ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡•ç‡§∞‡§ø‡§° (‡§Ö‡§¨ 8 ‡§ï‡•â‡§≤‡§Æ: #, ‡§ó‡•ç‡§∞‡•Å‡§™, ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡§ø‡§Ø‡§æ, ‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä, ‡§ï‡•Å‡§≤ ‡§ó‡§≤‡§§, ‡§ü‡•Ä‡§Æ 5 ‡§Ö‡§Ç‡§ï, ‡§∏‡§¶‡§∏‡•ç‡§Ø 10 ‡§Ö‡§Ç‡§ï, ‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞) */
    .leaderboard-item.team {
      grid-template-columns: 30px 1.2fr 1fr 0.7fr 0.7fr 0.7fr 0.7fr 1fr;
    }
    .leaderboard-header {
      display: grid;
      grid-template-columns: 30px 1.5fr 0.7fr 0.7fr 0.7fr 0.7fr 0.7fr 0.7fr;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-bottom: 2px solid #ddd;
      margin-bottom: 0.5rem;
      font-size: 14px;
    }
    /* ‡§ü‡•Ä‡§Æ ‡§π‡•á‡§°‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è (8 ‡§ï‡•â‡§≤‡§Æ) */
    .leaderboard-header.team {
      grid-template-columns: 30px 1.2fr 1fr 0.7fr 0.7fr 0.7fr 0.7fr 1fr;
    }
    .badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .hidden-audio { display: none; }
    .group-A { background: #3498db20; color: #3498db; }
    .group-B { background: #e74c3c20; color: #e74c3c; }
    .group-C { background: #2ecc7120; color: #2ecc71; }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    @media (max-width: 768px) {
      body { font-size: 14px; }
      .leaderboard-header, .leaderboard-item { font-size: 12px; grid-template-columns: auto; }
      .player-input, .answers, .leaderboard-item { grid-template-columns: 1fr; }
      .answer-type-buttons { flex-direction: column; align-items: stretch; }
    }
    /* --- Timer Styles --- */
    .timer-container {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .timer-svg { transform: rotate(-90deg); }
    .timer-bg { fill: none; stroke: #eee; stroke-width: 4; }
    .timer-progress {
      fill: none;
      stroke: var(--accent);
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.1s linear;
    }
    .timer-text { fill: var(--primary); font-size: 16px; transform: rotate(90deg); }
    /* --- Feedback Message Styles --- */
    #feedbackMessage {
      text-align: center;
      font-size: 24px;
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
      margin: 10px 0;
    }
    #feedbackMessage.show {
      opacity: 1;
      transform: translateY(0);
    }
    /* --- Correct Answer Highlight --- */
    .highlight-correct {
      background: #2ecc71 !important;
      color: white !important;
      border-color: #27ae60 !important;
    }
    /* --- Leaderboard Filter Buttons --- */
    #leaderboardFilters {
      margin-bottom: 10px;
      text-align: center;
    }
    #leaderboardFilters button {
      margin: 0 5px;
      padding: 5px 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Player Setup -->
  <div class="section player-setup">
    <h2><i class="fas fa-users"></i> ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h2>
    <div class="player-input">
      <input type="text" id="playerName" placeholder="‡§®‡§æ‡§Æ">
      <select id="groupSelect">
        <option value="A">‡§ó‡•ç‡§∞‡•Å‡§™ A</option>
        <option value="B">‡§ó‡•ç‡§∞‡•Å‡§™ B</option>
        <option value="C">‡§ó‡•ç‡§∞‡•Å‡§™ C</option>
      </select>
      <button onclick="addPlayer()">
        <i class="fas fa-plus"></i> ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
      </button>
    </div>
    <button onclick="startGame()" style="width:100%">
      <i class="fas fa-play"></i> ‡§ó‡•á‡§Æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
    </button>
  </div>

  <!-- Game Screen -->
  <div class="section game-screen">
    <h2 id="currentGroup"></h2>
    <div class="question-info">
      <span id="currentPlayerName"></span>, ‡§Ü‡§™‡§ï‡•Ä ‡§¨‡§æ‡§∞‡•Ä!
    </div>
    <div class="question-box" id="question"></div>

    <!-- Timer Container (Display in top-right corner) -->
    <div class="timer-container">
      <svg class="timer-svg" width="60" height="60">
        <circle class="timer-bg" cx="30" cy="30" r="28"></circle>
        <circle class="timer-progress" cx="30" cy="30" r="28"></circle>
        <text x="30" y="35" text-anchor="middle" class="timer-text">10</text>
      </svg>
    </div>

    <!-- Feedback Message -->
    <div id="feedbackMessage"></div>

    <div class="answers" id="answers"></div>
    <div class="answer-type-buttons">
      <button class="answer-type-btn" onclick="setAnswerType('member')">‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ú‡§µ‡§æ‡§¨</button>
      <button class="answer-type-btn" onclick="setAnswerType('team')">‡§ü‡•Ä‡§Æ ‡§ú‡§µ‡§æ‡§¨</button>
    </div>
    <div class="score-board">
      <h3><i class="fas fa-chart-line"></i> ‡§∏‡•ç‡§ï‡•ã‡§∞</h3>
      <div id="scoreList"></div>
    </div>
    <button onclick="endGame()" style="background:var(--accent);width:100%">
      <i class="fas fa-flag-checkered"></i> ‡§ó‡•á‡§Æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
    </button>
  </div>

  <!-- Sound Elements -->
  <audio id="correctSound" class="hidden-audio">
    <source src="sounds/correct-answer.mp3" type="audio/mpeg">
  </audio>
  <audio id="incorrectSound" class="hidden-audio">
    <source src="sounds/incorect.mp3" type="audio/mpeg">
  </audio>

  <!-- Leaderboard -->
  <div class="section leaderboard">
    <h2><i class="fas fa-trophy"></i> ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§°</h2>
    <div id="leaderboardFilters">
      <button onclick="setLeaderboardView('individual')">‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§</button>
      <button onclick="setLeaderboardView('team')">‡§ü‡•Ä‡§Æ</button>
    </div>
    <div class="leaderboard-header" id="leaderboardHeader">
      <!-- ‡§ö‡§Ø‡§®‡§ø‡§§ ‡§µ‡•ç‡§Ø‡•Ç ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§π‡•á‡§°‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã‡§ó‡§æ -->
    </div>
    <div id="leaderboard"></div>
  </div>

  <script>
    const GameManager = {
      currentQuestion: null,
      players: [],
      currentGroupIndex: 0,
      currentPlayerIndex: 0, // ‡§∏‡§Æ‡•Ç‡§π ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡•Ä
      questions: [
        {
          "question": "'‡§∂‡•ç‡§∞‡§Æ-‡§µ‡§ø‡§≠‡§æ‡§ú‡§® ‡§î‡§∞ ‡§ú‡§æ‡§§‡§ø ‡§™‡•ç‡§∞‡§•‡§æ' ‡§™‡§æ‡§† ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?",
          "correct": "‡§≠‡•Ä‡§Æ‡§∞‡§æ‡§µ ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞",
          "options": ["‡§Æ‡§π‡§æ‡§§‡•ç‡§Æ‡§æ ‡§ó‡§æ‡§Ç‡§ß‡•Ä", "‡§≠‡•Ä‡§Æ‡§∞‡§æ‡§µ ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞", "‡§ú‡§µ‡§æ‡§π‡§∞‡§≤‡§æ‡§≤ ‡§®‡•á‡§π‡§∞‡•Ç", "‡§∞‡§æ‡§Æ‡§Æ‡§®‡•ã‡§π‡§∞ ‡§≤‡•ã‡§π‡§ø‡§Ø‡§æ"],
          "difficulty": 1
        },
        {
          "question": "‡§≠‡•Ä‡§Æ‡§∞‡§æ‡§µ ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ ‡§ï‡§¨ ‡§π‡•Å‡§Ü ‡§•‡§æ?",
          "correct": "1891 ‡§à.",
          "options": ["1889 ‡§à.", "1891 ‡§à.", "1901 ‡§à.", "1911 ‡§à."],
          "difficulty": 2
        },
        {
          "question": "‡§≠‡•Ä‡§Æ‡§∞‡§æ‡§µ ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ ‡§ï‡§π‡§æ‡§Å ‡§π‡•Å‡§Ü ‡§•‡§æ?",
          "correct": "‡§Æ‡§π‡•Ç, ‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂",
          "options": ["‡§™‡§ü‡§®‡§æ, ‡§¨‡§ø‡§π‡§æ‡§∞", "‡§Æ‡§π‡•Ç, ‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂", "‡§¨‡§≤‡§ø‡§Ø‡§æ, ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡•ç‡§∞‡§¶‡•á‡§∂", "‡§µ‡§æ‡§∞‡§æ‡§£‡§∏‡•Ä, ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡•ç‡§∞‡§¶‡•á‡§∂"],
          "difficulty": 2
        },
        {
          "question": "'‡§∂‡•ç‡§∞‡§Æ-‡§µ‡§ø‡§≠‡§æ‡§ú‡§® ‡§î‡§∞ ‡§ú‡§æ‡§§‡§ø ‡§™‡•ç‡§∞‡§•‡§æ' ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§ï‡•Ä ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§µ‡§ø‡§ß‡§æ ‡§π‡•à?",
          "correct": "‡§®‡§ø‡§¨‡§Ç‡§ß",
          "options": ["‡§ï‡§π‡§æ‡§®‡•Ä", "‡§ï‡§µ‡§ø‡§§‡§æ", "‡§®‡§ø‡§¨‡§Ç‡§ß", "‡§≠‡§æ‡§∑‡§£"],
          "difficulty": 1
        },
        {
          "question": "‡§≠‡•Ä‡§Æ‡§∞‡§æ‡§µ ‡§Ö‡§Ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§ï‡•Ä ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§ï‡§¨ ‡§π‡•Å‡§à ‡§•‡•Ä?",
          "correct": "1956 ‡§à.",
          "options": ["1950 ‡§à.", "1956 ‡§à.", "1960 ‡§à.", "1966 ‡§à."],
          "difficulty": 2
        },
        {
          "question": "'‡§µ‡§ø‡§∑ ‡§ï‡•á ‡§¶‡§æ‡§Å‡§§' ‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?",
          "correct": "‡§®‡§≤‡§ø‡§® ‡§µ‡§ø‡§≤‡•ã‡§ö‡§® ‡§∂‡§∞‡•ç‡§Æ‡§æ",
          "options": ["‡§Ö‡§Æ‡§∞‡§ï‡§æ‡§Ç‡§§", "‡§®‡§≤‡§ø‡§® ‡§µ‡§ø‡§≤‡•ã‡§ö‡§® ‡§∂‡§∞‡•ç‡§Æ‡§æ", "‡§µ‡§ø‡§®‡•ã‡§¶ ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§Ø‡§§‡•Ä‡§Ç‡§¶‡•ç‡§∞ ‡§Æ‡§ø‡§∂‡•ç‡§∞"],
          "difficulty": 1
        }
        // ... ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§≠‡•Ä ‡§ú‡•ã‡§°‡§º‡•á ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ...
      ],
      usedQuestionIndices: [],
      answerType: 'member', // ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞

      addPlayer(name, group) {
        this.players.push({
          id: Date.now(),
          name,
          group,
          score: 0,
          correctAnswers: 0,
          wrongAnswers: 0,
          history: []
        });
      },

      saveGameState() {
        const gameData = {
          date: new Date().toISOString(),
          players: this.players,
          totalRounds: this.currentGroupIndex,
          usedQuestionIndices: this.usedQuestionIndices
        };
        localStorage.setItem('antakshariHistory', JSON.stringify(gameData));
      },

      loadHistory() {
        const history = localStorage.getItem('antakshariHistory');
        if(history) {
          const savedData = JSON.parse(history);
          this.players = savedData.players;
          this.usedQuestionIndices = savedData.usedQuestionIndices || [];
        }
      },

      getGroups() {
        return [...new Set(this.players.map(p => p.group))];
      },

      getCurrentGroup() {
        const groups = this.getGroups();
        return groups[this.currentGroupIndex % groups.length];
      },

      getCurrentPlayer() {
        const currentGroup = this.getCurrentGroup();
        const playersInGroup = this.players.filter(player => player.group === currentGroup);
        if (playersInGroup.length === 0) return null;
        return playersInGroup[this.currentPlayerIndex % playersInGroup.length];
      },

      moveToNextPlayer() {
        const currentGroup = this.getCurrentGroup();
        const playersInGroup = this.players.filter(player => player.group === currentGroup);
        this.currentPlayerIndex = (this.currentPlayerIndex + 1) % playersInGroup.length;
        if (this.currentPlayerIndex === 0) {
          this.currentGroupIndex++;
        }
      },

      updateScores(group, isCorrect, selectedAnswer, answerType) {
        let scoreToAdd = 0;
        if (isCorrect) {
          scoreToAdd = answerType === 'member' ? 10 : 5; // ‡§∏‡§¶‡§∏‡•ç‡§Ø: 10 ‡§Ö‡§Ç‡§ï, ‡§ü‡•Ä‡§Æ: 5 ‡§Ö‡§Ç‡§ï
        } else {
          scoreToAdd = -5; // ‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡§∞ -5 ‡§Ö‡§Ç‡§ï
        }

        // ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡§∞ ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡•á ‡§≤‡§ø‡§è)
        this.players.forEach(player => {
          if(player.group === group) {
            player.score += scoreToAdd;
            if (isCorrect) player.correctAnswers++; 
            else player.wrongAnswers++;
            player.history.push({
              question: this.currentQuestion.question,
              answer: selectedAnswer,
              correct: isCorrect,
              answerType: answerType,
              points: scoreToAdd,
              timestamp: new Date().toISOString()
            });
          }
        });
        this.saveGameState();
      },

      getUnusedQuestionIndex() {
        const availableIndices = Array.from({ length: this.questions.length }, (_, i) => i)
                                      .filter(index => !this.usedQuestionIndices.includes(index));
        if (availableIndices.length === 0) {
          return -1;
        }
        const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
        return randomIndex;
      }
    };

    // Global timer variable
    let timerInterval;
    // Global variable for leaderboard view ('individual' ‡§Ø‡§æ 'team')
    let currentLeaderboardView = 'individual';

    // --- Feedback Message Functionality ---
    function showFeedback(message) {
      const feedbackEl = document.getElementById('feedbackMessage');
      feedbackEl.textContent = message;
      feedbackEl.classList.add('show');
      setTimeout(() => {
        feedbackEl.classList.remove('show');
        feedbackEl.textContent = '';
      }, 2000);
    }

    // Game Functions
    function addPlayer() {
      const name = document.getElementById('playerName').value.trim();
      const group = document.getElementById('groupSelect').value;
      if(name) {
        GameManager.addPlayer(name, group);
        updateScoreList();
        document.getElementById('playerName').value = '';
      }
    }

    function startGame() {
      if(GameManager.players.length === 0) return alert("‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 1 ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç!");
      document.querySelector('.player-setup').style.display = 'none';
      document.querySelector('.game-screen').style.display = 'block';
      showNextQuestion();
    }

    function showNextQuestion() {
      // ‡§™‡§ø‡§õ‡§≤‡•á ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§ï‡•ã ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç
      clearInterval(timerInterval);

      const currentGroup = GameManager.getCurrentGroup();
      const currentPlayer = GameManager.getCurrentPlayer();

      if (!currentPlayer) {
        showFeedback("‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§Ø‡§æ! ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§");
        endGame();
        return;
      }

      document.getElementById('currentGroup').textContent = `‡§ö‡§æ‡§≤‡•Ç ‡§™‡§æ‡§≤‡•Ä: ‡§ó‡•ç‡§∞‡•Å‡§™ ${currentGroup}`;
      document.getElementById('currentPlayerName').textContent = currentPlayer.name;

      const unusedQuestionIndex = GameManager.getUnusedQuestionIndex();
      if (unusedQuestionIndex === -1) {
        showFeedback("‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§è! ‡§ó‡•á‡§Æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§");
        endGame();
        return;
      }

      GameManager.currentQuestion = GameManager.questions[unusedQuestionIndex];
      GameManager.usedQuestionIndices.push(unusedQuestionIndex);

      document.getElementById('question').textContent = GameManager.currentQuestion.question;

      const answersDiv = document.getElementById('answers');
      answersDiv.innerHTML = '';
      GameManager.currentQuestion.options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(option);
        answersDiv.appendChild(btn);
      });

      // Reset ‡§î‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç ‡§ü‡§æ‡§á‡§Æ‡§∞
      resetTimerUI();
      startTimer();
    }

    // Timer Functions (10 ‡§∏‡•á‡§ï‡§Ç‡§°, 100ms interval)
    function resetTimerUI() {
      const timerText = document.querySelector('.timer-text');
      const timerProgress = document.querySelector('.timer-progress');
      const circleLength = 2 * Math.PI * 28;
      timerText.textContent = '10';
      timerProgress.style.strokeDasharray = circleLength;
      timerProgress.style.strokeDashoffset = 0;
    }

    function startTimer() {
      const totalTime = 10 * 1000; // 10 ‡§∏‡•á‡§ï‡§Ç‡§° (‡§Æ‡§ø‡§≤‡•Ä‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç)
      const startTime = Date.now();
      const timerText = document.querySelector('.timer-text');
      const timerProgress = document.querySelector('.timer-progress');
      const circleLength = 2 * Math.PI * 28;

      timerInterval = setInterval(() => {
        let elapsed = Date.now() - startTime;
        let timeLeft = totalTime - elapsed;
        if(timeLeft <= 0) {
          timerText.textContent = '0';
          timerProgress.style.strokeDashoffset = circleLength;
          clearInterval(timerInterval);
          autoTimeUp();
        } else {
          let secondsLeft = Math.ceil(timeLeft / 1000);
          timerText.textContent = secondsLeft;
          let offset = circleLength * (elapsed / totalTime);
          timerProgress.style.strokeDashoffset = offset;
        }
      }, 100);
    }

    function autoTimeUp() {
      // ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§µ‡§æ‡§≤‡•á ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§π‡§æ‡§à‡§≤‡§æ‡§á‡§ü ‡§ï‡§∞‡•á‡§Ç
      const answersDiv = document.getElementById('answers');
      Array.from(answersDiv.children).forEach(btn => {
        if(btn.textContent === GameManager.currentQuestion.correct) {
          btn.classList.add('highlight-correct');
        }
      });
      // ‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§∏‡§æ‡§â‡§Ç‡§° ‡§™‡•ç‡§≤‡•á ‡§ï‡§∞‡•á‡§Ç
      audio.incorrect.currentTime = 0;
      audio.incorrect.play();
      showFeedback(`‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§! ‚ùå ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞: ${GameManager.currentQuestion.correct} (-5 ‡§Ö‡§Ç‡§ï)`);
      const currentGroup = GameManager.getCurrentGroup();
      GameManager.updateScores(currentGroup, false, "", GameManager.answerType);
      updateScoreList();
      GameManager.moveToNextPlayer();
      // ‡§•‡•ã‡§°‡§º‡•Ä ‡§¶‡•á‡§∞ ‡§¨‡§æ‡§¶ ‡§Ö‡§ó‡§≤‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Å
      setTimeout(showNextQuestion, 1500);
    }

    const audio = {
      correct: document.getElementById('correctSound'),
      incorrect: document.getElementById('incorrectSound')
    };

    function setAnswerType(type) {
      GameManager.answerType = type;
      // ‡§ö‡§Ø‡§®‡§ø‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•ã UI ‡§Æ‡•á‡§Ç ‡§π‡§æ‡§á‡§≤‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ï‡•ã‡§° ‡§ú‡•ã‡§°‡§º‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
    }

    function checkAnswer(selectedAnswer) {
      clearInterval(timerInterval);

      const isCorrect = selectedAnswer === GameManager.currentQuestion.correct;
      const currentGroup = GameManager.getCurrentGroup();
      const answerType = GameManager.answerType;
      let pointsMessage = "";

      if(isCorrect) {
        audio.correct.currentTime = 0;
        audio.correct.play();
        pointsMessage = answerType === 'member' ? "+10 ‡§Ö‡§Ç‡§ï" : "+5 ‡§Ö‡§Ç‡§ï";
        showFeedback(`‡§∏‡§π‡•Ä ‡§ú‡§µ‡§æ‡§¨! üéâ ${pointsMessage}`);
      } else {
        audio.incorrect.currentTime = 0;
        audio.incorrect.play();
        pointsMessage = "-5 ‡§Ö‡§Ç‡§ï";
        // ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§µ‡§æ‡§≤‡•á ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§π‡§æ‡§à‡§≤‡§æ‡§á‡§ü ‡§ï‡§∞‡•á‡§Ç
        const answersDiv = document.getElementById('answers');
        Array.from(answersDiv.children).forEach(btn => {
          if(btn.textContent === GameManager.currentQuestion.correct) {
            btn.classList.add('highlight-correct');
          }
        });
        showFeedback(`‡§ó‡§≤‡§§ ‡§ú‡§µ‡§æ‡§¨! ‚ùå ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞: ${GameManager.currentQuestion.correct} ${pointsMessage}`);
      }

      GameManager.updateScores(currentGroup, isCorrect, selectedAnswer, answerType);
      updateScoreList();
      GameManager.moveToNextPlayer();
      setTimeout(showNextQuestion, 1500);
    }

    function endGame() {
      document.querySelector('.game-screen').style.display = 'none';
      showLeaderboard();
    }

    function updateScoreList() {
      const scoreList = document.getElementById('scoreList');
      scoreList.innerHTML = GameManager.players
        .map(player => `
          <div class="leaderboard-item">
            <div class="badge group-${player.group}">${player.group}</div>
            <div>${player.name}</div>
            <div>${player.score} ‡§Ö‡§Ç‡§ï</div>
            <div>${player.correctAnswers} ‚úîÔ∏è</div>
            <div>${player.wrongAnswers} ‚ùå</div>
          </div>
        `).join('');
    }

    // Leaderboard Functions
    function setLeaderboardView(view) {
      currentLeaderboardView = view;
      showLeaderboard();
    }

    function showLeaderboard() {
      const leaderboard = document.getElementById('leaderboard');
      const leaderboardHeader = document.getElementById('leaderboardHeader');

      if(currentLeaderboardView === 'individual') {
  // ‡§π‡•á‡§°‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç: ‡§®‡§æ‡§Æ, ‡§ó‡•ç‡§∞‡•Å‡§™, ‡§ü‡•Ä‡§Æ ‡§Ö‡§Ç‡§ï, ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ö‡§Ç‡§ï, ‡§ó‡§≤‡§§ (-5) ‡§î‡§∞ ‡§ï‡•Å‡§≤ ‡§Ö‡§Ç‡§ï
  leaderboardHeader.innerHTML = `
    <div>#</div>
    <div>‡§®‡§æ‡§Æ</div>
    <div>‡§ó‡•ç‡§∞‡•Å‡§™</div>
    <div>‡§ü‡•Ä‡§Æ ‡§Ö‡§Ç‡§ï</div>
    <div>‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ö‡§Ç‡§ï</div>
    <div>‡§ó‡§≤‡§§ (-5)</div>
    <div>‡§ï‡•Å‡§≤ ‡§Ö‡§Ç‡§ï</div>
  `;
  
   // ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§â‡§®‡§ï‡•á ‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞ (player.score) ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§π‡§Æ ‡§ó‡§£‡§ø‡§§‡•Ä‡§Ø ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§∏‡•á ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å‡§ó‡•á
  const sortedPlayers = [...GameManager.players].sort((a, b) => b.score - a.score);
  
  leaderboard.innerHTML = sortedPlayers.map((player, index) => {
    // ‡§ü‡•Ä‡§Æ ‡§î‡§∞ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ï‡•á ‡§∏‡§π‡•Ä ‡§ú‡§µ‡§æ‡§¨‡•ã‡§Ç ‡§ï‡•Ä ‡§ó‡§ø‡§®‡§§‡•Ä
    const teamCorrect = player.history.filter(e => e.correct && e.answerType === 'team').length;
    const memberCorrect = player.history.filter(e => e.correct && e.answerType === 'member').length;
    const wrongCount = player.history.filter(e => !e.correct).length;
    
    // ‡§Ö‡§Ç‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§î‡§∞ ‡§ò‡§ü‡§æ‡§®‡•á ‡§ï‡§æ ‡§ó‡§£‡§ø‡§§‡•Ä‡§Ø ‡§π‡§ø‡§∏‡§æ‡§¨
    const teamPoints = teamCorrect * 5;      // ‡§ü‡•Ä‡§Æ ‡§∏‡•á ‡§∏‡§π‡•Ä: 5 ‡§Ö‡§Ç‡§ï ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§π‡•Ä ‡§ú‡§µ‡§æ‡§¨
    const memberPoints = memberCorrect * 10;   // ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§∏‡•á ‡§∏‡§π‡•Ä: 10 ‡§Ö‡§Ç‡§ï ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§π‡•Ä ‡§ú‡§µ‡§æ‡§¨
    const penalty = wrongCount * 5;            // ‡§ó‡§≤‡§§ ‡§ú‡§µ‡§æ‡§¨: -5 ‡§Ö‡§Ç‡§ï ‡§™‡•ç‡§∞‡§§‡§ø ‡§ó‡§≤‡§§
    const netScore = teamPoints + memberPoints - penalty;
          return `
         <div class="leaderboard-item">
        <div>${index + 1}</div>
        <div>${player.name}</div>
        <div class="badge group-${player.group}">‡§ó‡•ç‡§∞‡•Å‡§™ ${player.group}</div>
        <div>${teamPoints}</div>
        <div>${memberPoints}</div>
        <div>${penalty}</div>
        <div>${netScore} ‡§Ö‡§Ç‡§ï</div>
      </div>
          `;
        }).join('');
      } else if(currentLeaderboardView === 'team') {
        // ‡§ü‡•Ä‡§Æ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‚Äì ‡§Ø‡§π‡§æ‡§Ç ‡§∏‡§≠‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§Ç‡§ï‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º (‡§è‡§ó‡•ç‡§∞‡•Ä‡§ó‡•á‡§ü) ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à
        leaderboardHeader.innerHTML = `
          <div>#</div>
          <div>‡§ó‡•ç‡§∞‡•Å‡§™</div>
          <div>‡§ú‡§µ‡§æ‡§¨ ‡§¶‡§ø‡§Ø‡§æ</div>
          <div>‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä</div>
          <div>‡§ï‡•Å‡§≤ ‡§ó‡§≤‡§§</div>
          <div>‡§ü‡•Ä‡§Æ 5 ‡§Ö‡§Ç‡§ï</div>
          <div>‡§∏‡§¶‡§∏‡•ç‡§Ø 10 ‡§Ö‡§Ç‡§ï</div>
          <div>‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞</div>
        `;
        const groups = {};
        GameManager.players.forEach(player => {
          if(!groups[player.group]) {
            groups[player.group] = {
              score: 0,
              correct: 0,
              wrong: 0,
              teamCorrect: 0,
              memberCorrect: 0,
              answersGiven: 0,  // ‡§ï‡•Å‡§≤ ‡§ú‡§µ‡§æ‡§¨‡•ã‡§Ç ‡§ï‡•Ä ‡§ó‡§ø‡§®‡§§‡•Ä
              players: []
            };
          }
          groups[player.group].score += player.score;
          groups[player.group].correct += player.correctAnswers;
          groups[player.group].wrong += player.wrongAnswers;
          groups[player.group].teamCorrect += player.history.filter(e => e.correct && e.answerType === 'team').length;
          groups[player.group].memberCorrect += player.history.filter(e => e.correct && e.answerType === 'member').length;
          groups[player.group].answersGiven += player.history.length;
          groups[player.group].players.push(player);
        });
        const groupArray = Object.keys(groups).map(group => ({
          group,
          ...groups[group]
        })).sort((a, b) => b.score - a.score);
        leaderboard.innerHTML = groupArray.map((grp, index) => `
  <div class="leaderboard-item team">
    <div>${index + 1}</div>
    <div class="badge group-${grp.group}">‡§ó‡•ç‡§∞‡•Å‡§™ ${grp.group}</div>
    <div>${grp.answersGiven}</div>
    <div>${grp.correct}</div>
    <div>${grp.wrong}</div>
    <div>${grp.teamCorrect}</div>
    <div>${grp.memberCorrect}</div>
    <div>${grp.score / 2} ‡§Ö‡§Ç‡§ï</div>
  </div>
`).join('');
      }
      document.querySelector('.leaderboard').style.display = 'block';
    }

    // Initialize
    window.onload = () => {
      GameManager.loadHistory();
      if(GameManager.players.length > 0) {
        updateScoreList();
        showLeaderboard();
      }
    };
  </script>
</body>
</html>
